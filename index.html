<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Phantom Connect Test</title>
  <style>body{font-family:system-ui,Arial;background:#071029;color:#e6eef8;padding:24px}</style>
</head>
<body>
  <h2>Phantom Connect Test</h2>
  <p id="status">Status: idle</p>
  <button id="check">Check Provider</button>
  <button id="trusted">Trusted Connect</button>
  <button id="connect">Connect</button>
  <pre id="log" style="background:#021025;padding:12px;border-radius:8px;white-space:pre-wrap;"></pre>

  <script>
    const status = (s) => { document.getElementById('status').textContent = 'Status: ' + s; };
    const log = (t) => { const p = document.getElementById('log'); p.textContent += '['+new Date().toISOString()+'] '+t+'\\n'; };

    document.getElementById('check').onclick = () => {
      log('window.solana -> ' + !!window.solana);
      log('isPhantom -> ' + (window.solana && window.solana.isPhantom));
      status('checked console/log');
    };

    document.getElementById('trusted').onclick = async () => {
      try {
        if (!window.solana) throw new Error('provider missing');
        status('attempting trusted connect');
        const resp = await window.solana.connect({ onlyIfTrusted: true });
        log('trusted connect response: ' + JSON.stringify(resp));
        status('trusted connect OK');
      } catch (e) {
        log('trusted connect error: ' + e);
        status('trusted connect error');
      }
    };

    document.getElementById('connect').onclick = async () => {
      try {
        if (!window.solana) throw new Error('provider missing');
        status('connecting');
        const resp = await window.solana.connect();
        log('connect response: ' + JSON.stringify(resp));
        status('connected: ' + (resp?.publicKey?.toString?.() || 'unknown'));
        // listen for disconnect
        window.solana.on && window.solana.on('disconnect', () => { log('provider disconnect'); status('disconnected'); });
      } catch (e) {
        log('connect error: ' + e);
        status('connect error');
      }
    };

    // Helpful message if injection is late (mobile webviews)
    (function waitForInjection(){
      if (window.solana && window.solana.isPhantom) { log('provider already injected'); return; }
      let attempts = 0;
      const t = setInterval(()=> {
        attempts++;
        if (window.solana && window.solana.isPhantom) { log('provider injected'); clearInterval(t); }
        if (attempts > 25) { log('provider not detected after wait'); clearInterval(t); }
      }, 200);
    })();
  </script>
</body>
</html>
